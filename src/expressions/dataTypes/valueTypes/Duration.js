"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const AbstractDuration_1 = require("./AbstractDuration");
const YearMonthDuration_1 = require("./YearMonthDuration");
const DayTimeDuration_1 = require("./DayTimeDuration");
const MONTHS_TO_MIN_MAX_VALUES = [
    [28, 31],
    [59, 62],
    [89, 91],
    [120, 123],
    [150, 153],
    [181, 184],
    [212, 215],
    [242, 245],
    [273, 276],
    [303, 306],
    [334, 337],
    [365, 366]
];
function computeMinDays(duration) {
    const years = Math.abs(duration.getYears());
    const months = Math.abs(duration.getMonths());
    const minNumberOfLeapYears = Math.floor(years / 4);
    return Math.abs(duration.getDays()) +
        (months === 0 ? 0 : MONTHS_TO_MIN_MAX_VALUES[months - 1][0]) +
        minNumberOfLeapYears * 366 + (years - minNumberOfLeapYears) * 365;
}
function computeMaxDays(duration) {
    const years = Math.abs(duration.getYears());
    const months = Math.abs(duration.getMonths());
    const maxNumberOfLeapYears = Math.ceil(years / 4);
    return Math.abs(duration.getDays()) +
        (months === 0 ? 0 : MONTHS_TO_MIN_MAX_VALUES[months - 1][1]) +
        maxNumberOfLeapYears * 366 + (years - maxNumberOfLeapYears) * 365;
}
/**
 * @extends {AbstractDuration}
 */
class Duration extends AbstractDuration_1.default {
    constructor(yearMonthDuration, dayTimeDuration) {
        super();
        this._yearMonthDuration = yearMonthDuration;
        this._dayTimeDuration = dayTimeDuration;
    }
    getRawMonths() {
        return this._yearMonthDuration.getRawMonths();
    }
    getRawSeconds() {
        return this._dayTimeDuration.getRawSeconds();
    }
    getYearMonthDuration() {
        return this._yearMonthDuration;
    }
    getDayTimeDuration() {
        return this._dayTimeDuration;
    }
    getYears() {
        return this._yearMonthDuration.getYears();
    }
    getMonths() {
        return this._yearMonthDuration.getMonths();
    }
    getDays() {
        return this._dayTimeDuration.getDays();
    }
    getHours() {
        return this._dayTimeDuration.getHours();
    }
    getMinutes() {
        return this._dayTimeDuration.getMinutes();
    }
    getSeconds() {
        return this._dayTimeDuration.getSeconds();
    }
    isPositive() {
        return this._yearMonthDuration.isPositive() && this._dayTimeDuration.isPositive();
    }
    compare(other) {
        if (this.isPositive() && !other.isPositive()) {
            return 1;
        }
        if (!this.isPositive() && other.isPositive()) {
            return -1;
        }
        if (this.equals(other)) {
            return 0;
        }
        const thisMinDays = computeMinDays(this);
        const thisMaxDays = computeMaxDays(this);
        const otherMinDays = computeMinDays(other);
        const otherMaxDays = computeMaxDays(other);
        if (thisMinDays === otherMinDays && thisMaxDays === otherMaxDays) {
            const thisSecondsWithoutDays = this.getHours() * 3600 + this.getMinutes() * 60 + this.getSeconds();
            const otherSecondsWithoutDays = other.getHours() * 3600 + other.getMinutes() * 60 + other.getSeconds();
            if (thisSecondsWithoutDays > otherSecondsWithoutDays) {
                return 1;
            }
            if (thisSecondsWithoutDays < otherSecondsWithoutDays) {
                return -1;
            }
            return 0;
        }
        const bothPositive = this.isPositive() && other.isPositive();
        if (thisMinDays > otherMaxDays) {
            return bothPositive ? 1 : -1;
        }
        if (thisMaxDays < otherMinDays) {
            return bothPositive ? -1 : 1;
        }
    }
    toString() {
        const string = this.isPositive() ? 'P' : '-P';
        const TYM = this._yearMonthDuration.toStringWithoutP();
        const TDT = this._dayTimeDuration.toStringWithoutP();
        if (TYM === '0M') {
            return string + TDT;
        }
        if (TDT === 'T0S') {
            return string + TYM;
        }
        return string + TYM + TDT;
    }
}
/**
 * @static
 * @param   {string}  string
 * @return  {?Duration}
 */
Duration.fromString = function (string) {
    return new Duration(YearMonthDuration_1.default.fromString(string), DayTimeDuration_1.default.fromString(string));
};
/**
 * @static
 * @param   {YearMonthDuration}  yearMonthDuration
 * @return  {Duration}
 */
Duration.fromYearMonthDuration = function (yearMonthDuration) {
    return new Duration(yearMonthDuration, new DayTimeDuration_1.default(yearMonthDuration.isPositive() ? 0 : -0));
};
/**
 * @static
 * @param   {DayTimeDuration}  dayTimeDuration
 * @return  {Duration}
 */
Duration.fromDayTimeDuration = function (dayTimeDuration) {
    return new Duration(new YearMonthDuration_1.default(dayTimeDuration.isPositive() ? 0 : -0), dayTimeDuration);
};
exports.default = Duration;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRHVyYXRpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJEdXJhdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHlEQUFrRDtBQUNsRCwyREFBb0Q7QUFDcEQsdURBQWdEO0FBRWhELE1BQU0sd0JBQXdCLEdBQUc7SUFDaEMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO0lBQ1IsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO0lBQ1IsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO0lBQ1IsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0NBQ1YsQ0FBQztBQUVGLFNBQVMsY0FBYyxDQUFFLFFBQVE7SUFDaEMsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztJQUM1QyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDO0lBQzlDLE1BQU0sb0JBQW9CLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFFbkQsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNsQyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsd0JBQXdCLENBQUMsTUFB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QWUsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLGVBQWUsQ0FBQyxDQUFDO0FBQ3BHLENBQUMsQ0FBQztBQUVGLGtCQUFlLFFBQVEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBBYnN0cmFjdER1cmF0aW9uIGZyb20gJy4vQWJzdHJhY3REdXJhdGlvbic7XG5pbXBvcnQgWWVhck1vbnRoRHVyYXRpb24gZnJvbSAnLi9ZZWFyTW9udGhEdXJhdGlvbic7XG5pbXBvcnQgRGF5VGltZUR1cmF0aW9uIGZyb20gJy4vRGF5VGltZUR1cmF0aW9uJztcblxuY29uc3QgTU9OVEhTX1RPX01JTl9NQVhfVkFMVUVTID0gW1xuXHRbMjgsIDMxXSxcblx0WzU5LCA2Ml0sXG5cdFs4OSwgOTFdLFxuXHRbMTIwLCAxMjNdLFxuXHRbMTUwLCAxNTNdLFxuXHRbMTgxLCAxODRdLFxuXHRbMjEyLCAyMTVdLFxuXHRbMjQyLCAyNDVdLFxuXHRbMjczLCAyNzZdLFxuXHRbMzAzLCAzMDZdLFxuXHRbMzM0LCAzMzddLFxuXHRbMzY1LCAzNjZdXG5dO1xuXG5mdW5jdGlvbiBjb21wdXRlTWluRGF5cyAoZHVyYXRpb24pIHtcblx0Y29uc3QgeWVhcnMgPSBNYXRoLmFicyhkdXJhdGlvbi5nZXRZZWFycygpKTtcblx0Y29uc3QgbW9udGhzID0gTWF0aC5hYnMoZHVyYXRpb24uZ2V0TW9udGhzKCkpO1xuXHRjb25zdCBtaW5OdW1iZXJPZkxlYXBZZWFycyA9IE1hdGguZmxvb3IoeWVhcnMgLyA0KTtcblxuXHRyZXR1cm4gTWF0aC5hYnMoZHVyYXRpb24uZ2V0RGF5cygpKSArXG5cdFx0KG1vbnRocyA9PT0gMCA/IDAgOiBNT05USFNfVE9fTUlOX01BWF9WQUxVRVNbbW9udGhzIC0gMV1bMF0pICtcblx0XHRtaW5OdW1iZXJPZkxlYXBZZWFycyAqIDM2NiArICh5ZWFycyAtIG1pbk51bWJlck9mTGVhcFllYXJzKSAqIDM2NTtcbn1cblxuZnVuY3Rpb24gY29tcHV0ZU1heERheXMgKGR1cmF0aW9uKSB7XG5cdGNvbnN0IHllYXJzID0gTWF0aC5hYnMoZHVyYXRpb24uZ2V0WWVhcnMoKSk7XG5cdGNvbnN0IG1vbnRocyA9IE1hdGguYWJzKGR1cmF0aW9uLmdldE1vbnRocygpKTtcblx0Y29uc3QgbWF4TnVtYmVyT2ZMZWFwWWVhcnMgPSBNYXRoLmNlaWwoeWVhcnMgLyA0KTtcblxuXHRyZXR1cm4gTWF0aC5hYnMoZHVyYXRpb24uZ2V0RGF5cygpKSArXG5cdFx0KG1vbnRocyA9PT0gMCA/IDAgOiBNT05USFNfVE9fTUlOX01BWF9WQUxVRVNbbW9udGhzIC0gMV1bMV0pICtcblx0XHRtYXhOdW1iZXJPZkxlYXBZZWFycyAqIDM2NiArICh5ZWFycyAtIG1heE51bWJlck9mTGVhcFllYXJzKSAqIDM2NTtcbn1cblxuLyoqXG4gKiBAZXh0ZW5kcyB7QWJzdHJhY3REdXJhdGlvbn1cbiAqL1xuY2xhc3MgRHVyYXRpb24gZXh0ZW5kcyBBYnN0cmFjdER1cmF0aW9uIHtcblx0X3llYXJNb250aER1cmF0aW9uOiBZZWFyTW9udGhEdXJhdGlvbjtcblx0X2RheVRpbWVEdXJhdGlvbjogRGF5VGltZUR1cmF0aW9uO1xuXHRzdGF0aWMgZnJvbVN0cmluZzogKHN0cmluZzogYW55KSA9PiBEdXJhdGlvbjtcblx0c3RhdGljIGZyb21ZZWFyTW9udGhEdXJhdGlvbjogKHllYXJNb250aER1cmF0aW9uOiBhbnkpID0+IER1cmF0aW9uO1xuXHRzdGF0aWMgZnJvbURheVRpbWVEdXJhdGlvbjogKGRheVRpbWVEdXJhdGlvbjogYW55KSA9PiBEdXJhdGlvbjtcblx0Y29uc3RydWN0b3IgKHllYXJNb250aER1cmF0aW9uLCBkYXlUaW1lRHVyYXRpb24pIHtcblx0XHRzdXBlcigpO1xuXG5cdFx0dGhpcy5feWVhck1vbnRoRHVyYXRpb24gPSB5ZWFyTW9udGhEdXJhdGlvbjtcblx0XHR0aGlzLl9kYXlUaW1lRHVyYXRpb24gPSBkYXlUaW1lRHVyYXRpb247XG5cdH1cblxuXHRnZXRSYXdNb250aHMgKCkge1xuXHRcdHJldHVybiB0aGlzLl95ZWFyTW9udGhEdXJhdGlvbi5nZXRSYXdNb250aHMoKTtcblx0fVxuXG5cdGdldFJhd1NlY29uZHMgKCkge1xuXHRcdHJldHVybiB0aGlzLl9kYXlUaW1lRHVyYXRpb24uZ2V0UmF3U2Vjb25kcygpO1xuXHR9XG5cblx0Z2V0WWVhck1vbnRoRHVyYXRpb24gKCkge1xuXHRcdHJldHVybiB0aGlzLl95ZWFyTW9udGhEdXJhdGlvbjtcblx0fVxuXG5cdGdldERheVRpbWVEdXJhdGlvbiAoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX2RheVRpbWVEdXJhdGlvbjtcblx0fVxuXG5cdGdldFllYXJzICgpIHtcblx0XHRyZXR1cm4gdGhpcy5feWVhck1vbnRoRHVyYXRpb24uZ2V0WWVhcnMoKTtcblx0fVxuXG5cdGdldE1vbnRocyAoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX3llYXJNb250aER1cmF0aW9uLmdldE1vbnRocygpO1xuXHR9XG5cblx0Z2V0RGF5cyAoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX2RheVRpbWVEdXJhdGlvbi5nZXREYXlzKCk7XG5cdH1cblxuXHRnZXRIb3VycyAoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX2RheVRpbWVEdXJhdGlvbi5nZXRIb3VycygpO1xuXHR9XG5cblx0Z2V0TWludXRlcyAoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX2RheVRpbWVEdXJhdGlvbi5nZXRNaW51dGVzKCk7XG5cdH1cblxuXHRnZXRTZWNvbmRzICgpIHtcblx0XHRyZXR1cm4gdGhpcy5fZGF5VGltZUR1cmF0aW9uLmdldFNlY29uZHMoKTtcblx0fVxuXG5cdGlzUG9zaXRpdmUgKCkge1xuXHRcdHJldHVybiB0aGlzLl95ZWFyTW9udGhEdXJhdGlvbi5pc1Bvc2l0aXZlKCkgJiYgdGhpcy5fZGF5VGltZUR1cmF0aW9uLmlzUG9zaXRpdmUoKTtcblx0fVxuXG5cdGNvbXBhcmUgKG90aGVyKSB7XG5cdFx0aWYgKHRoaXMuaXNQb3NpdGl2ZSgpICYmICFvdGhlci5pc1Bvc2l0aXZlKCkpIHtcblx0XHRcdHJldHVybiAxO1xuXHRcdH1cblxuXHRcdGlmICghdGhpcy5pc1Bvc2l0aXZlKCkgJiYgb3RoZXIuaXNQb3NpdGl2ZSgpKSB7XG5cdFx0XHRyZXR1cm4gLTE7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMuZXF1YWxzKG90aGVyKSkge1xuXHRcdFx0cmV0dXJuIDA7XG5cdFx0fVxuXG5cdFx0Y29uc3QgdGhpc01pbkRheXMgPSBjb21wdXRlTWluRGF5cyh0aGlzKTtcblx0XHRjb25zdCB0aGlzTWF4RGF5cyA9IGNvbXB1dGVNYXhEYXlzKHRoaXMpO1xuXHRcdGNvbnN0IG90aGVyTWluRGF5cyA9IGNvbXB1dGVNaW5EYXlzKG90aGVyKTtcblx0XHRjb25zdCBvdGhlck1heERheXMgPSBjb21wdXRlTWF4RGF5cyhvdGhlcik7XG5cblx0XHRpZiAodGhpc01pbkRheXMgPT09IG90aGVyTWluRGF5cyAmJiB0aGlzTWF4RGF5cyA9PT0gb3RoZXJNYXhEYXlzKSB7XG5cdFx0XHRjb25zdCB0aGlzU2Vjb25kc1dpdGhvdXREYXlzID0gdGhpcy5nZXRIb3VycygpICogMzYwMCArIHRoaXMuZ2V0TWludXRlcygpICogNjAgKyB0aGlzLmdldFNlY29uZHMoKTtcblx0XHRcdGNvbnN0IG90aGVyU2Vjb25kc1dpdGhvdXREYXlzID0gb3RoZXIuZ2V0SG91cnMoKSAqIDM2MDAgKyBvdGhlci5nZXRNaW51dGVzKCkgKiA2MCArIG90aGVyLmdldFNlY29uZHMoKTtcblx0XHRcdGlmICh0aGlzU2Vjb25kc1dpdGhvdXREYXlzID4gb3RoZXJTZWNvbmRzV2l0aG91dERheXMpIHtcblx0XHRcdFx0cmV0dXJuIDE7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzU2Vjb25kc1dpdGhvdXREYXlzIDwgb3RoZXJTZWNvbmRzV2l0aG91dERheXMpIHtcblx0XHRcdFx0cmV0dXJuIC0xO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gMDtcblx0XHR9XG5cblx0XHRjb25zdCBib3RoUG9zaXRpdmUgPSB0aGlzLmlzUG9zaXRpdmUoKSAmJiBvdGhlci5pc1Bvc2l0aXZlKCk7XG5cdFx0aWYgKHRoaXNNaW5EYXlzID4gb3RoZXJNYXhEYXlzKSB7XG5cdFx0XHRyZXR1cm4gYm90aFBvc2l0aXZlID8gMSA6IC0xO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzTWF4RGF5cyA8IG90aGVyTWluRGF5cykge1xuXHRcdFx0cmV0dXJuIGJvdGhQb3NpdGl2ZSA/IC0xIDogMTtcblx0XHR9XG5cdH1cblxuXHR0b1N0cmluZyAoKSB7XG5cdFx0Y29uc3Qgc3RyaW5nID0gdGhpcy5pc1Bvc2l0aXZlKCkgPyAnUCcgOiAnLVAnO1xuXHRcdGNvbnN0IFRZTSA9IHRoaXMuX3llYXJNb250aER1cmF0aW9uLnRvU3RyaW5nV2l0aG91dFAoKTtcblx0XHRjb25zdCBURFQgPSB0aGlzLl9kYXlUaW1lRHVyYXRpb24udG9TdHJpbmdXaXRob3V0UCgpO1xuXG5cdFx0aWYgKFRZTSA9PT0gJzBNJykge1xuXHRcdFx0cmV0dXJuIHN0cmluZyArIFREVDtcblx0XHR9XG5cdFx0aWYgKFREVCA9PT0gJ1QwUycpIHtcblx0XHRcdHJldHVybiBzdHJpbmcgKyBUWU07XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHN0cmluZyArIFRZTSArIFREVDtcblx0fVxufVxuXG4vKipcbiAqIEBzdGF0aWNcbiAqIEBwYXJhbSAgIHtzdHJpbmd9ICBzdHJpbmdcbiAqIEByZXR1cm4gIHs/RHVyYXRpb259XG4gKi9cbkR1cmF0aW9uLmZyb21TdHJpbmcgPSBmdW5jdGlvbiAoc3RyaW5nKSB7XG5cdHJldHVybiBuZXcgRHVyYXRpb24oXG5cdFx0XHRZZWFyTW9udGhEdXJhdGlvbi5mcm9tU3RyaW5nKHN0cmluZyksXG5cdFx0XHREYXlUaW1lRHVyYXRpb24uZnJvbVN0cmluZyhzdHJpbmcpKTtcbn07XG5cbi8qKlxuICogQHN0YXRpY1xuICogQHBhcmFtICAge1llYXJNb250aER1cmF0aW9ufSAgeWVhck1vbnRoRHVyYXRpb25cbiAqIEByZXR1cm4gIHtEdXJhdGlvbn1cbiAqL1xuRHVyYXRpb24uZnJvbVllYXJNb250aER1cmF0aW9uID0gZnVuY3Rpb24gKHllYXJNb250aER1cmF0aW9uKSB7XG5cdHJldHVybiBuZXcgRHVyYXRpb24oeWVhck1vbnRoRHVyYXRpb24sIG5ldyBEYXlUaW1lRHVyYXRpb24oeWVhck1vbnRoRHVyYXRpb24uaXNQb3NpdGl2ZSgpID8gMCA6IC0wKSk7XG59O1xuXG4vKipcbiAqIEBzdGF0aWNcbiAqIEBwYXJhbSAgIHtEYXlUaW1lRHVyYXRpb259ICBkYXlUaW1lRHVyYXRpb25cbiAqIEByZXR1cm4gIHtEdXJhdGlvbn1cbiAqL1xuRHVyYXRpb24uZnJvbURheVRpbWVEdXJhdGlvbiA9IGZ1bmN0aW9uIChkYXlUaW1lRHVyYXRpb24pIHtcblx0cmV0dXJuIG5ldyBEdXJhdGlvbihuZXcgWWVhck1vbnRoRHVyYXRpb24oZGF5VGltZUR1cmF0aW9uLmlzUG9zaXRpdmUoKSA/IDAgOiAtMCksIGRheVRpbWVEdXJhdGlvbik7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBEdXJhdGlvbjtcbiJdfQ==